# Docker Compose per DaDude Agent
version: '3.8'

services:
  agent:
    build: .
    image: dadude-agent:latest
    container_name: dadude-agent
    restart: unless-stopped
    
    # Network: host per accedere alla rete locale
    network_mode: host
    
    environment:
      - DADUDE_SERVER_URL=https://your-server.com
      - DADUDE_AGENT_ID=agent-001
      - DADUDE_AGENT_NAME=Agent Site 1
      - DADUDE_AGENT_TOKEN=your-secure-token
      - DADUDE_DNS_SERVERS=192.168.4.1,8.8.8.8
      - DADUDE_API_PORT=8080
      - DADUDE_LOG_LEVEL=INFO
    
    # Oppure usa file config
    volumes:
      - ./config:/app/config:ro
    
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

# Per deployment su rete bridge (non host)
# networks:
#   default:
#     driver: bridge
#     ipam:
#       config:
#         - subnet: 172.20.0.0/24

